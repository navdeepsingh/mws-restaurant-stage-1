class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants/"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/"}static fetchRestaurants(){return new Promise(function(t,e){let r,n=indexedDB.open("mws-restaurant-db",6);n.onupgradeneeded=function(t){if(console.log("UpgradeNeeded Running.."),!(r=t.target.result).objectStoreNames.contains("restaurants")){r.createObjectStore("restaurants")}},n.onsuccess=function(e){let n=(r=e.target.result).transaction(["restaurants"],"readonly").objectStore("restaurants").get(1);n.onsuccess=function(e){let n=e.target.result;void 0!==n?(console.log("Getting JSON from: IndexedDB"),t(n)):t(fetch(DBHelper.DATABASE_URL).then(t=>t).then(t=>{let e=t.json();return DBHelper.createDB(r,e),console.log("Getting JSON from: Network"),e}).catch(t=>{console.log(`Error: ${t}`)}))},n.onerror=function(t){console.log("On Error")}}})}static createDB(t,e){e.then(e=>{let r=t.transaction(["restaurants"],"readwrite").objectStore("restaurants").add(e,1);r.onerror=function(t){console.log("Error",t.target.error.name)},r.onsuccess=function(t){console.log("Added Successfully")}})}static fetchRestaurantById(t){return DBHelper.fetchRestaurants().then(e=>{const r=e.find(e=>e.id==t);if(r)return fetch(DBHelper.REVIEWS_URL+`?restaurant_id=${r.id}`).then(t=>t.json()).then(t=>(r.reviews=t,r));console.log("Restaurant does not exist")})}static fetchRestaurantByCuisine(t){return DBHelper.fetchRestaurants().then(e=>{return e.filter(e=>e.cuisine_type==t)})}static fetchRestaurantByNeighborhood(t){return DBHelper.fetchRestaurants().then(e=>{return e.filter(e=>e.neighborhood==t)})}static fetchRestaurantByCuisineAndNeighborhood(t,e){return DBHelper.fetchRestaurants().then(r=>{let n=r;return"all"!=t&&(n=n.filter(e=>e.cuisine_type==t)),"all"!=e&&(n=n.filter(t=>t.neighborhood==e)),n})}static fetchNeighborhoods(){return DBHelper.fetchRestaurants().then(t=>{const e=t.map((e,r)=>t[r].neighborhood);return e.filter((t,r)=>e.indexOf(t)==r)})}static fetchCuisines(){return DBHelper.fetchRestaurants().then(t=>{const e=t.map((e,r)=>t[r].cuisine_type);return e.filter((t,r)=>e.indexOf(t)==r)})}static urlForRestaurant(t){return`./restaurant.html?id=${t.id}`}static imageUrlForRestaurant(t){return`/img/${t.id}.jpg`}static mapMarkerForRestaurant(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:DBHelper.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}static toggleFavoriteRestaurant(t,e,r){return new Promise(function(n,o){fetch(DBHelper.DATABASE_URL+`${t.id}/?is_favorite=${e}`,{method:"put"}).then(t=>{t.ok||console.log("Something goes wrong.."),e=!e,r.classList.toggle("fav"),n(e)})})}static postRestaurantReview(t,e){let r={};for(var n of e.entries())r[n[0]]=n[1];return r.restaurant_id=t.id,new Promise(function(t,e){fetch(DBHelper.REVIEWS_URL,{method:"POST",body:JSON.stringify(r),headers:{Accept:"application/json"}}).then(e=>{t(e.ok)}).catch(t=>{throw t})})}}